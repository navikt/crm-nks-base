<!--
    This Visualforce page will get base64 data from SAF and render it in an iFrame.

    Flow:
    1. VF page is called
    2. Constructor retrieves the parameters and apply them
    3. doInit calls controller to get the document
    4. Document is retrieved through the method getDocument
    5. Document is displayed

    URL parameters when using this VF page is:
    journalId
    documentInfoId
    variantFormat
    fileName
    width
    height
-->
<apex:page controller="NKS_SafViewDocumentController" title="{!title}" contentType="{!contentType}">
    <apex:form>
        <!-- Action function to trigger loading of the document -->
        <apex:actionFunction name="doInit" action="{!getDocument}" rerender="allPanel" />
        <!-- Penal that is refreshed when all the document has been loaded. Contain all ux parts -->
        <apex:outputPanel id="allPanel">
            <!-- Panel for error messages to the user -->
            <apex:outputPanel rendered="{!isError} ">
                <p>{!errorMessage}</p>
            </apex:outputPanel>

            <!-- Panel BEFORE document load -->
            <apex:outputPanel rendered="{!NOT(initialised) && NOT(isError)}">
                <apex:slds />
                <div class="slds-scope">
                    <div role="status" class="slds-spinner slds-spinner--medium ">
                        <span class="slds-assistive-text ">Laster dokument</span>
                        <div class="slds-spinner__dot-a "></div>
                        <div class="slds-spinner__dot-b "></div>
                    </div>
                </div>
                <!-- script that runs on load after the controller is initialized and triggers the doInit action function on top -->
                <script>
                    window.onload = function () {
                        doInit();
                    };
                </script>
            </apex:outputPanel>

            <!-- Panel AFTER document load -->
            <apex:outputPanel rendered="{!initialised}">
                <iframe id="documentFrame " src="{!DocumentData} " width="{!width} " height="{!height} " title="Document ">
                    Kan ikke laste dokumentet.
                </iframe>
            </apex:outputPanel>

        </apex:outputPanel>
    </apex:form>
</apex:page>