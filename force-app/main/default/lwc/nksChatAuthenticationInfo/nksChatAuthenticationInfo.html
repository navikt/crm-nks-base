<template>
    <lightning-card>
        <!-- Spinner while loading authentication information -->
        <template if:true={isLoading}>
            <div class="slds-var-p-top_small slds-var-p-bottom_small">
                <lightning-spinner
                    size="medium"
                    title="Getting authentication status"
                >
                </lightning-spinner>
            </div>
        </template>

        <template if:false={isLoading}>
            <div class="slds-var-p-left_medium slds-var-p-right_medium">
                <template if:true={authenticationComplete}>
                    <div
                        class="slds-notify_alert slds-theme_success"
                        role="alert"
                    >
                        <span class="slds-assistive-text"
                            >{labels.IDENTITY_CONFIRMED_DISCLAIMER}</span
                        >
                        <lightning-layout>
                            <div class="slds-var-p-right_small">
                                <lightning-icon
                                    icon-name="utility:success"
                                    size="x-small"
                                    variant="inverse"
                                >
                                </lightning-icon>
                            </div>
                            <h2>{labels.IDENTITY_CONFIRMED_DISCLAIMER}</h2>
                        </lightning-layout>
                    </div>
                </template>

                <template if:false={authenticationComplete}>
                    <div
                        class="slds-notify_alert slds-theme_alert-texture slds-theme_warning"
                        role="alert"
                    >
                        <span class="slds-assistive-text">warning</span>
                        <lightning-layout>
                            <div class="slds-var-p-right_small">
                                <lightning-icon
                                    icon-name="utility:warning"
                                    size="x-small"
                                >
                                </lightning-icon>
                            </div>
                            <h2>{labels.UNCONFIRMED_IDENTITY_WARNING}</h2>
                        </lightning-layout>
                    </div>
                </template>

                <!-- Button to initiate authentication request -->
                <template if:false={authenticationRequested}>
                    <div class="slds-var-p-top_small">
                        <template if:true={sendingAuthRequest}>
                            <lightning-spinner
                                size="small"
                                title="Sending authentication request"
                            >
                            </lightning-spinner>
                        </template>
                        <lightning-button
                            label="Send autentiseringsforespÃ¸rsel"
                            disabled={cannotInitAuth}
                            variant="neutral"
                            onclick={requestAuthentication}
                            role="button"
                            style="display: grid; width: 100%"
                        >
                        </lightning-button>
                    </div>
                </template>

                <!-- START PROGRESS INDICATOR -->
                <template if:true={authenticationRequested}>
                    <template if:false={authenticationComplete}>
                        <div class="slds-progress slds-progress_vertical">
                            <ol class="slds-progress__list" role="list">
                                <li
                                    class="slds-progress__item slds-is-completed"
                                    role="listitem"
                                >
                                    <span
                                        class="slds-icon_container slds-icon-utility-success slds-progress__marker slds-progress__marker_icon slds-progress__marker_icon-success"
                                        title="Complete"
                                    >
                                        <lightning-icon
                                            icon-name="utility:success"
                                            size="x-small"
                                        ></lightning-icon>
                                    </span>
                                    <div
                                        class="slds-progress__item_content slds-grid slds-grid_align-spread"
                                    >
                                        {labels.AUTH_REQUESTED}
                                    </div>
                                </li>

                                <template if:true={authenticationStarted}>
                                    <li
                                        class="slds-progress__item slds-is-completed"
                                        role="listitem"
                                    >
                                        <span
                                            class="slds-icon_container slds-icon-utility-success slds-progress__marker slds-progress__marker_icon slds-progress__marker_icon-success"
                                            title="Complete"
                                        >
                                            <lightning-icon
                                                icon-name="utility:success"
                                                size="x-small"
                                            ></lightning-icon>
                                        </span>
                                        <div
                                            class="slds-progress__item_content slds-grid slds-grid_align-spread"
                                        >
                                            {labels.AUTH_STARTED}
                                        </div>
                                    </li>
                                </template>

                                <template if:false={authenticationStarted}>
                                    <li
                                        class="slds-progress__item slds-is-active"
                                        role="listitem"
                                    >
                                        <div
                                            class="slds-progress__marker"
                                        ></div>
                                        <div
                                            class="slds-progress__item_content slds-grid slds-grid_align-spread"
                                        >
                                            {labels.AUTH_STARTED}
                                        </div>
                                    </li>
                                </template>

                                <template if:true={authenticationComplete}>
                                    <li
                                        class="slds-progress__item slds-is-completed"
                                        role="listitem"
                                    >
                                        <span
                                            class="slds-icon_container slds-icon-utility-success slds-progress__marker slds-progress__marker_icon slds-progress__marker_icon-success"
                                            title="Complete"
                                        >
                                            <lightning-icon
                                                icon-name="utility:success"
                                                size="x-small"
                                            ></lightning-icon>
                                        </span>
                                        <div
                                            class="slds-progress__item_content slds-grid slds-grid_align-spread"
                                        >
                                            {labels.IDENTITY_CONFIRMED}
                                        </div>
                                    </li>
                                </template>

                                <template if:false={authenticationComplete}>
                                    <li
                                        class="slds-progress__item"
                                        role="listitem"
                                    >
                                        <div
                                            class="slds-progress__marker"
                                        ></div>
                                        <div
                                            class="slds-progress__item_content slds-grid slds-grid_align-spread"
                                        >
                                            {labels.IDENTITY_CONFIRMED}
                                        </div>
                                    </li>
                                </template>
                            </ol>
                        </div>
                    </template>
                    <template if:true={authenticationComplete}>
                        <div class="slds-var-p-top_small">
                            <!-- CASE LINK -->
                            <c-nks-person-badges
                                record-id={accountId}
                                object-api-name="Account"
                                person-relation-field="CRM_Person__c"
                                assistive-header="Sikkerhetstiltak og andre etiketter"
                            ></c-nks-person-badges>

                            <!-- CASE LINK -->
                            <c-nks-record-info
                                viewed-record-id={caseId}
                                viewed-object-api-name="Case"
                                displayed-fields={caseFields}
                                card-label="Brukerinfo"
                                icon-name="standard:account"
                                num-cols="3"
                                show-link="true"
                            >
                            </c-nks-record-info>

                            <!-- PERSON INFO -->
                            <c-nks-record-info
                                record-id={accountId}
                                viewed-object-api-name="Person__c"
                                object-api-name="Account"
                                displayed-fields={personFields}
                                relationship-field="CRM_Person__c"
                                num-cols="3"
                                show-link="false"
                            >
                            </c-nks-record-info>

                            <!-- NAV UNIT -->
                            <c-nks-nav-unit-single
                                record-id={accountId}
                                relation-field="CRM_Person__c"
                                object-api-name="Account"
                                type="PERSON_LOCATION"
                            ></c-nks-nav-unit-single>

                            <!-- PERSON LINKS -->
                            <c-nks-record-info
                                record-id={accountId}
                                viewed-object-api-name="Person__c"
                                object-api-name="Account"
                                displayed-fields="NKS_ModiaURL__c, NKS_GoSysURL__c, NKS_AAregisterURL__c, NKS_AktivitetsplanURL__c"
                                relationship-field="CRM_Person__c"
                                num-cols="1"
                                show-link="false"
                                hide-labels="true"
                                card-label="Nyttige linker"
                                icon-name="standard:link"
                            >
                            </c-nks-record-info>
                        </div>
                    </template>
                </template>
                <!-- END PROGRESS INDICATOR -->
            </div>
        </template>
    </lightning-card>
</template>
